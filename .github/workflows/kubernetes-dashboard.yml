name: build-kubernetes-dashboard

on:
  workflow_dispatch:

env:
  GOPATH: "/tmp/go"
  GOHOME: "/tmp/go"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3
      - name: Check out dashboard repository
        uses: actions/checkout@v3
        with:
          repository: kubernetes/dashboard
          path: dashboard
          ref: v2.7.0
      - name: Prepare for build
        run: |
           cd dashboard
           sed -i 's/MIN_GO_MINOR_VERSION = 19/MIN_GO_MINOR_VERSION = 18/g' Makefile
           cd /tmp
           curl -L https://golang.google.cn/dl/go1.19.7.linux-amd64.tar.gz -o go.tar.gz
           tar zxf go.tar.gz
      - name: Build 
        run: |
           cd dashboard
           export PATH=$GOPATH/bin:$PATH
           yarn
           make build
           make docker-build-head
#      - uses: actions/upload-artifact@v3
#        with:
#          name: dashboard
#          path: /tmp/*.tar.gz
